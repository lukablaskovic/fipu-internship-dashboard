import{a as I}from"./LayoutAuthenticated.0d193c5e.js";import{y as i,u as e,U as k,W as j,C as u,K as c,z as a,F as d,x as l,H as h,M as y,A as g,r as M,V as z,J as p,G as m,I as $,q as U}from"./vue.f9cfebed.js";import{d as _,y as t,b,m as f,R as C,l as x}from"./index.79b4ef11.js";import{b0 as S,a2 as O,b1 as B,b2 as A,b3 as D,b4 as N,b5 as L,b6 as V}from"./BaseButton.bc4b7cea.js";import{h as P}from"./moment-setup.afefb272.js";import"./SnackBar.1a5a1851.js";import"./BaseButtons.e0ebdabe.js";import"./CardBox.07416a0a.js";import"./vendor.15896b3d.js";const E={class:"flex flex-row items-center px-3 py-3 bg-gray-200 dark:bg-slate-900/50"},K={key:1,class:"ml-3"},R={key:2,class:"h-10 w-full flex items-center justify-center font-medium"},T={mounted(){document.addEventListener("keydown",this.handleKeyPress)},unmounted(){document.removeEventListener("keydown",this.handleKeyPress)},methods:{async checkNewMessage(){t.content.length==1&&await t.updateUserActivity(!0),t.content.length==0&&await t.updateUserActivity(!1)},handleKeyPress(n){n.key==="Enter"&&t.content.length>0&&!t.inputDelayed&&(n.preventDefault(),t.c.status!=="archived"&&document.getElementById("sendButton").click())}}},F=Object.assign(T,{__name:"MessageInput",setup(n){return(s,r)=>(l(),i("div",E,[e(t).c.status!="archived"?k((l(),i("input",{key:0,onInput:r[0]||(r[0]=o=>s.checkNewMessage()),"onUpdate:modelValue":r[1]||(r[1]=o=>e(t).content=o),type:"text",class:u(["border-none bg-transparent focus:outline-none text-sm items-center w-full border text-fipu_gray dark:text-gray-300 bg-white dark:bg-slate-800 rounded-3xl h-12 px-6",e(t).inputDelayed?"opacity-40 cursor-not-allowed":"dark:hover:bg-slate-700/40 dark:focus:bg-slate-800 hover:bg-gray-50 focus:bg-white"]),placeholder:"Type your message...."},null,34)),[[j,e(t).content]]):c("",!0),e(t).c.status!="archived"?(l(),i("div",K,[a("button",{id:"sendButton",onClick:r[2]||(r[2]=o=>e(t).content.length>0&&!e(t).inputDelayed?e(t).sendMessage():""),class:u(["flex items-center justify-center h-10 w-10 rounded-full bg-gray-300 text-fipu_gray dark:bg-gray-800 dark:text-gray-300",e(t).content.length>0&&!e(t).inputDelayed?"hover:bg-white dark:hover:bg-gray-700/50":"cursor-not-allowed opacity-40"])},[d(_,{path:e(S),size:20},null,8,["path"])],2)])):(l(),i("div",R,"Ovaj razgovor je arhiviran."))]))}}),q=b(F,[["__scopeId","data-v-697c67a9"]]),G={key:0,class:"flex items-center justify-between mt-5 relative"},W=["onClick"],H={__name:"ConversationsGroupsNavbar",setup(n){const s=[{name:"Svi razgovori",type:"normal"},{name:"Ozna\u010Deni",type:"starred"},{name:"Arhivirani",type:"archived"}];return(r,o)=>e(f).currentUser.account_type=="admin"?(l(),i("div",G,[(l(),i(h,null,y(s,v=>a("a",{class:u(["flex items-center justify-center pb-3 text-xs relative cursor-pointer",e(t).grouping==v.type?"text-fipu_blue font-semibold":"text-gray-500 dark:text-gray-400 font-normal hover:underline"]),onClick:Se=>e(t).grouping=v.type},[a("span",null,g(v.name),1)],10,W)),64)),a("span",{class:u([[{"left-0 right-0 w-6 bottom-0":e(t).grouping=="normal"},{"left-1/2 right-0 -translate-x-1/2 w-12 bottom-0 ml-2":e(t).grouping=="starred"},{"left-full w-6 bottom-0 -ml-6":e(t).grouping=="archived"}],"absolute h-1 bg-fipu_blue rounded-full transition-all duration-300"])},null,2)])):c("",!0)}},J={class:"absolute bottom-0 right-0 lg:ml-0 lg:mr-2 flex items-center justify-center gap-2 w-full"},Q=["value"],X={data(){return{selectedOption:null,options:[]}},async mounted(){this.options=await t.getUsersWithoutConversations()}},Y=Object.assign(X,{__name:"AddConversationButton",setup(n){const s=M(null);return(r,o)=>(l(),i("div",{class:u(["h-full relative pt-2",r.options.length==0?"opacity-40 pointer-events-none ":""])},[a("div",J,[k(a("select",{"onUpdate:modelValue":o[0]||(o[0]=v=>s.value=v),class:"border-none bg-transparent focus:outline-none text-sm items-center w-full border text-fipu_gray dark:text-gray-300 bg-white hover:bg-gray-50 focus:bg-white dark:bg-slate-800 dark:hover:bg-slate-700/40 dark:focus:bg-slate-800 rounded-3xl"},[(l(!0),i(h,null,y(r.options,v=>(l(),i("option",{value:v.id},g(v.ime+" "+v.prezime),9,Q))),256))],512),[[z,s.value]]),a("button",{class:u([s.value==null?"bg-fipu_blue/50 cursor-not-allowed":"bg-fipu_dark_blue hover:bg-fipu_blue dark:hover:bg-fipu_blue","flex items-center justify-center shadow-sm min-w-[40px] h-[40px] w-[40px] drop-shadow text-white rounded-full"]),onClick:o[1]||(o[1]=v=>s.value!=null?e(t).addConversation(s.value):"")},[d(_,{path:e(O),size:20},null,8,["path"])],2)])],2))}}),Z={class:"flex flex-row items-center -mx-2 lg:-mx-0"},ee={__name:"ConversationsSearch",setup(n){return(s,r)=>(l(),i("div",Z,[r[0]||(r[0]=a("div",{class:"flex flex-row items-center"},[a("div",{class:"text-xl font-semibold text-fipu_gray dark:text-gray-300"},"Poruke")],-1)),c("",!0)]))}},te={class:"absolute text-xs text-gray-500 font-medium right-2 lg:right-0 top-2 lg:top-0 lg:mr-4 lg:mt-3"},se=["src"],re={key:1,class:"flex items-center justify-center animate-ping h-1.5 w-1.5 bg-rose-500 text-white font-medium text-xs rounded-full absolute -top-1 -right-1"},ae={key:0,class:"absolute right-1 lg:right-3 bottom-0 lg:bottom-2 flex gap-0 lg:gap-2"},ne={class:"flex flex-col ml-3 w-full"},le={class:"flex items-center"},oe={class:"text-sm font-medium truncate w-40"},ie={class:"text-xs truncate w-40"},ue={props:{name:{type:String,default:""},selected:{type:Boolean,default:!1},conversation:{type:Object,default:{}}},data(){return{timestamp:"",last_text:null,c:null,intervalId:null,hover:!1,cstatus:this.conversation.status}},beforeDestroy(){clearInterval(this.intervalId)},async mounted(){clearInterval(this.intervalId),this.last_text=await t.getLastMessage(this.conversation.user_1_id==f.currentUser.id?this.conversation.user_2_id:this.conversation.user_1_id),this.c=t.getUserDataFromConversationItem(this.conversation),this.timestamp=this.last_text!=null&&this.last_text.timestamp!=null?P(this.last_text.timestamp).fromNow():""},methods:{checkNewMessage(){return this.conversation.user_1_id==f.currentUser.id?this.conversation.user_1_last_message_read_id<this.conversation.user_2_last_message_read_id:this.conversation.user_1_last_message_read_id>this.conversation.user_2_last_message_read_id},getAvatar(n){return n!=null?n.avatar:""}}},de=Object.assign(ue,{__name:"ConversationItem",setup(n){return(s,r)=>s.cstatus==e(t).grouping||e(f).currentUser.account_type!="admin"?(l(),i("div",{key:0,class:"flex flex-col -mx-5 lg:-mx-4 mt-1 lg:mt-2",onClick:r[6]||(r[6]=o=>s.hover?"":e(t).selectConversation(s.c.id,n.conversation))},[a("div",{class:u(["flex items-center pt-2.5 pb-2.5 lg:pt-4 lg:pb-4 relative hover:bg-white dark:hover:bg-gray-800/25",n.selected?"border-l-2 bg-gradient-to-r pl-1.5 pr-2 lg:pr-4 lg:pl-3.5 from-sky-200 dark:from-sky-950/50 to-transparent border-fipu_dark_blue dark:border-fipu_dark_blue":"pl-2 pr-2 lg:pr-4 lg:pl-4 hover:rounded"])},[a("div",te,g(s.timestamp),1),d(e(C),{class:"cursor-default",to:s.c!=null&&e(f).currentUser.account_type=="admin"?"/studenti/"+s.c.process_instance_id:""},{default:p(()=>[a("div",{class:u([e(f).currentUser.account_type=="admin"?"cursor-pointer hover:scale-105 transition-all":"cursor-default","flex items-center justify-center h-9 w-9 lg:h-10 lg:w-10 rounded-full bg-fipu_blue text-white dark:text-fipu_gray dark:font-bold font-medium flex-shrink-0 relative"])},[s.getAvatar(s.c)!=""?(l(),i("img",{key:0,class:"absolute rounded-full aspect-square h-9 w-9 lg:h-10 lg:w-10",src:s.getAvatar(s.c),alt:""},null,8,se)):c("",!0),a("div",null,g(s.c!=null?s.c.ime[0]:""),1),s.checkNewMessage()&&n.conversation.id!=e(t).selectedConversationID?(l(),i("div",re)):c("",!0)],2)]),_:1},8,["to"]),e(f).currentUser.account_type=="admin"?(l(),i("div",ae,[a("div",{onMouseover:r[0]||(r[0]=o=>s.hover=!0),onMouseleave:r[1]||(r[1]=o=>s.hover=!1),onClick:r[2]||(r[2]=o=>{s.cstatus=="stared"?s.cstatus="normal":s.cstatus="starred",e(t).updateConversationStatus("starred",n.conversation)})},[d(_,{class:"hover:text-fipu_dark_blue hover:cursor-pointer",size:e(x).isLg?22:18,path:n.conversation.status=="starred"&&s.cstatus=="starred"||s.cstatus=="starred"?e(B):e(A)},null,8,["size","path"])],32),a("div",{onMouseover:r[3]||(r[3]=o=>s.hover=!0),onMouseleave:r[4]||(r[4]=o=>s.hover=!1),onClick:r[5]||(r[5]=o=>{s.cstatus=="archived"?s.cstatus="normal":s.cstatus="archived",e(t).updateConversationStatus("archived",n.conversation)})},[d(_,{class:"hover:text-fipu_dark_blue hover:cursor-pointer",size:e(x).isLg?22:18,path:n.conversation.status=="archived"&&s.cstatus=="archived"||s.cstatus=="archived"?e(D):e(N)},null,8,["size","path"])],32)])):c("",!0),a("div",ne,[a("div",le,[a("div",oe,g(s.c!=null?s.c.ime+" "+s.c.prezime:""),1)]),a("div",ie,g(s.last_text!=null?s.last_text.content:""),1)])],2)])):c("",!0)}}),ce={class:"absolute top-0 -right-8 lg:hidden"},ve={class:"flex flex-col w-full h-full pl-1 lg:pl-4 pr-1 lg:pr-4 py-4 -mr-4"},fe={key:0,class:"flxe flex-col"},ge={__name:"ConversationsSideBar",setup(n){return(s,r)=>(l(),i("div",{class:u(["flex flex-row flex-shrink-0 bg-gray-100 dark:bg-gray-900 p-4 absolute lg:relative h-full min-w-[256px] w-64 sm:w-80 md:w-96 transition-all duration-500 lg:duration-0 z-20",[e(t).collapsed?"-left-64 sm:-left-80 md:-left-96 lg:-left-0":"-left-0"]])},[a("div",ce,[a("div",{class:"w-8 h-8 flex justify-center items-center rounded-full",onClick:r[0]||(r[0]=o=>e(t).collapsed=!e(t).collapsed)},[d(_,{class:"hover:text-fipu_dark_blue hover:cursor-pointer",w:"40",h:"40",size:36,path:e(t).collapsed?e(L):e(V)},null,8,["path"])])]),a("div",ve,[d(ee),d(H),e(t).update?(l(),i("div",fe,[(l(!0),i(h,null,y(e(t).conversations,o=>(l(),m(de,{conversation:o,selected:e(t).selectedConversationID==o.id},null,8,["conversation","selected"]))),256))])):c("",!0),e(t).update?(l(),m(Y,{key:1})):c("",!0)])],2))}},pe={},me={class:"flex flex-col grow"},_e={class:"flex flex-col grow justify-end bg-white dark:bg-slate-900/25 overflow-hidden relative"};function he(n,s){return l(),i("div",me,[a("div",_e,[$(n.$slots,"default")])])}const w=b(pe,[["render",he]]);const ye={class:"flex flex-col grow h-[200px] overflow-y-auto bg-white dark:bg-slate-900/25 px-4 py-3 gap-1 scrollbar-none",id:"messageContainer"},be={class:"flex flex-col h-full gap-1"},xe={key:0,class:"w-0 h-0 overflow-hidden"},we={__name:"Conversation",setup(n){return(s,r)=>(l(),i("div",ye,[a("div",be,[r[2]||(r[2]=a("div",{class:"grow opacity-0"},"\xA0",-1)),$(s.$slots,"default",{},void 0,!0),a("div",{class:u([(e(t).c.user_1_id==e(f).currentUser.id?e(t).c.user_2_active:e(t).c.user_1_active)?"h-16 opacity-100":"h-0 opacity-0","flex gap-1 items-end transition-all duration-300"])},[r[0]||(r[0]=a("span",null,"Tipkanje",-1)),(e(t).c.user_1_id==e(f).currentUser.id?e(t).c.user_2_active:e(t).c.user_1_active)?(l(),i("div",xe,g(e(t).scrollToBottom()),1)):c("",!0),r[1]||(r[1]=a("span",{class:"loading-dots flex gap-2"},[a("span",null," . "),a("span",null," . "),a("span",null," . ")],-1))],2),r[3]||(r[3]=a("div",{class:"min-h-[4px]"},null,-1))])]))}},ke=b(we,[["__scopeId","data-v-0800cc8e"]]),$e=["src"],Ce={__name:"Message",props:{reverse:{type:Boolean,default:!1},text:{type:String,default:""},user:{type:Object,default:""}},setup(n){return(s,r)=>(l(),i("div",{class:u(["flex gap-3 items-end",{"flex-row-reverse":n.reverse}])},[d(e(C),{to:n.user.process_instance_id!=null?"/studenti/"+n.user.process_instance_id:""},{default:p(()=>[a("div",{class:u([[n.reverse?"bg-rose-600/70 dark:bg-rose-500/75":"bg-fipu_blue",n.user.process_instance_id!=null?"cursor-pointer hover:scale-105 transition-all":"cursor-default"],"flex items-center justify-center h-9 w-9 rounded-full text-white dark:text-fipu_gray dark:font-bold font-medium flex-shrink-0 relative overflow-hidden"])},[n.user.avatar!=""?(l(),i("img",{key:0,class:"absolute",src:n.user.avatar,alt:""},null,8,$e)):c("",!0),a("div",null,g(n.user.ime[0]),1)],2)]),_:1},8,["to"]),a("div",{class:u([n.reverse?"bg-indigo-100 dark:bg-gray-950/75 text-slate-900 dark:text-slate-300":"bg-stone-100  dark:bg-zinc-950/75 text-fipu_gray dark:text-zinc-300","relative text-sm py-2 px-4 shadow rounded-xl break-all"])},g(n.text),3)],2))}},Ie={class:"xl:max-w-7xl xl:mx-auto flex flex-col absolute h-full w-full justify-center items-center left-1/2 -translate-x-1/2"},je={class:"bg-gray-100 dark:bg-slate-800 h-full w-full flex flex-col drop-shadow"},Me={class:"grow flex flex-col justify-end"},ze={class:"flex flex-row grow antialiased text-gray-800 dark:text-gray-300 rounded overflow-hidden"},Ue={data(){return{intervalId:null,messageContainerRef:null}},created(){clearInterval(this.intervalId),this.intervalId=setInterval(async()=>{await t.updateConversations(f.currentUser.id),await t.getMessages(t.selectedConversation)},1e3)},unmounted(){clearInterval(this.intervalId)}},Ke=Object.assign(Ue,{__name:"MessagesView",setup(n){return t.getAllUsers(),U(()=>{}),(s,r)=>(l(),m(I,null,{default:p(()=>[a("div",Ie,[a("div",je,[a("div",Me,[a("div",ze,[d(ge),e(t).selectedConversation!=""?(l(),m(w,{key:0},{default:p(()=>[r[0]||(r[0]=a("div",{class:"absolute w-full h-16 bg-gradient-to-b dark:from-fipu_gray2 dark:via-fipu_gray2 from-white via-white top-0 right-2 pointer-events-none z-10"},null,-1)),d(ke,null,{default:p(()=>[(l(!0),i(h,null,y(e(t).messages,o=>(l(),m(Ce,{text:o.content,user:e(t).getUser(o),reverse:o.receiver_id==e(t).selectedConversation},null,8,["text","user","reverse"]))),256))]),_:1}),d(q)]),_:1})):(l(),m(w,{key:1},{default:p(()=>r[1]||(r[1]=[a("div",{class:"w-full h-full flex justify-center items-center"},"Odaberi razgovor",-1)])),_:1}))])])])])]),_:1}))}});export{Ke as default};
